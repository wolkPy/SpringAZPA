package py.com.qa.clases;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

import py.com.qa.configs.Configuracion;

public class Cierre {
	/* CONSTANTES */
	private static final String sqlUpdate = "update qa_planilla set ind_cerrado = ? where cod_empresa = ? and fecha = ?";
	private static final String sqlSelectAll = "select cod_empresa, fecha, ind_cerrado, cod_usr_cierre, fecha_cierre from qa_planilla order by fecha desc";
	private static final String sqlSelectId = "select cod_empresa, fecha, ind_cerrado, cod_usr_cierre, fecha_cierre from qa_planilla where cod_empresa = ? and fecha = ?";
	/* VARIABLES */
	private String codEmpresa;
	private String fecha;
	private String indCerrado;
	private String codUserCierre;
	private String fechaCierre;

	public void actualizar() {
		try {
			Connection con = Configuracion.CON;
			PreparedStatement pstmt = con.prepareStatement(sqlUpdate);
			pstmt.setString(1, this.indCerrado);
			pstmt.setString(2, this.codEmpresa);
			pstmt.setString(3, this.fecha);

			pstmt.executeUpdate();
			pstmt.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	public ArrayList<Planilla> getAll() {
		ArrayList<Planilla> planillas = new ArrayList<>();
		try {
			Connection con = Configuracion.CON;
			Statement stmt = con.createStatement();
			ResultSet rs = stmt.executeQuery(sqlSelectAll);
			Planilla p = null;
			while (rs.next()) {
				p = new Planilla(rs.getString("cod_empresa"), rs.getString("cod_sucursal"), rs.getLong("cod_planilla"),
						rs.getString("descripcion"), rs.getLong("cod_planilla_padre"), rs.getString("orden"),
						rs.getString("estado"), "");
				planillas.add(p);
			}
			stmt.close();
			rs.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return planillas;
	}

	public Planilla getById(String codEmpresa, String codSucursal, long codPlanilla) {
		try {
			Connection con = Configuracion.CON;
			PreparedStatement pstmt = con.prepareStatement(sqlSelectId);
			pstmt.setString(1, codEmpresa);
			pstmt.setString(2, codSucursal);
			pstmt.setLong(3, codPlanilla);

			ResultSet rs = pstmt.executeQuery();
			while (rs.next()) {
				this.setCodEmpresa(rs.getString("cod_empresa"));
				this.setCodSucursal(rs.getString("cod_sucursal"));
				this.setCodPlanilla(rs.getLong("cod_planilla"));
				this.setDescripcion(rs.getString("descripcion"));
				this.setCodPlanillaPadre(rs.getLong("cod_planilla_padre"));
				this.setOrden(rs.getString("orden"));
				this.setEstado(rs.getString("estado"));
			}
			pstmt.close();
			rs.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return this;
	}

	public String getCodEmpresa() {
		return codEmpresa;
	}

	public void setCodEmpresa(String codEmpresa) {
		this.codEmpresa = codEmpresa;
	}

	public String getFecha() {
		return fecha;
	}

	public void setFecha(String fecha) {
		this.fecha = fecha;
	}

	public String getIndi_cerrado() {
		return indCerrado;
	}

	public void setIndi_cerrado(String indi_cerrado) {
		this.indCerrado = indi_cerrado;
	}

	public String getCodUserCierre() {
		return codUserCierre;
	}

	public void setCodUserCierre(String codUserCierre) {
		this.codUserCierre = codUserCierre;
	}

	public String getFechaCierre() {
		return fechaCierre;
	}

	public void setFechaCierre(String fechaCierre) {
		this.fechaCierre = fechaCierre;
	}
}
